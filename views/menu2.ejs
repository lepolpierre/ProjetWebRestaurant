<%- include ('includes/head.ejs') %>
<script src="https://unpkg.com/vue"></script>
<link rel="stylesheet" type="text/css" href="/public/css/menu.css">
<script type="text/javascript" src="/public/js/main.js" defer></script>


</head>

<body>
  <%- include('includes/header.ejs') %>
  <h1>Menu</h1>

  <div id="app">

    <!-- CHOIX MENU CHKBOX -->
    <div id="choixMenu" >

        <!-- CHECKBOX ENTRER -->
      <div id="choixMenu2">
        <div class="chkBox">
          <div><label for="entrerChk"> entrer</label></div>
          <div><input type="checkbox" id="entrerChk" value="entrerChk" v-model="entrerChk"></div>
        </div>

        <!-- CHECKBOX PLAT -->
        <div class="chkBox">
          <div><label for="platChk"> plat</label></div>
          <div><input type="checkbox" id="platChkBox" value="platChk" v-model="platChk"></div>
        </div>

        <!-- CHECKBOX DESSERT -->
        <div class="chkBox">
          <div><label for="dessertChk"> dessert</label></div>
          <div><input type="checkbox" id="dessert" value="dessertChk" v-model="dessertChk"></div>
        </div id="chkBox">

        <!-- CHECKBOX VEGE -->
        <div class="chkBox">
          <div><label for="vegeChk"> vege</label></div>
          <div><input type="checkbox" id="vege" value="vegeChk" v-model="vegeChk"></div>
        </div>
      </div>
    </div>


  <!-- MENU COMPLET -->
      <div class="menuComplet">
        <div><div_plat v-bind:menu_componant="menuFiltred(entrerChk,platChk,dessertChk,vegeChk)"/></div>
      </div>

    </div>
  </div>
  <%- include('includes/end.ejs') %>
</body>

<!--  ---------------VUE JS --------------- -->

<script>
  Vue.component("div_plat", {
    props: ["menu_componant"],
    template: `   
    <div class="sousMenu">
    <div id="plat" v-for="repas in menu_componant">
      <div id="infoPlat">
      <a v-bind:href="'/menu/'+repas._id">
        <div>
          {{repas.name}}
        </div>

        <div>
          description : {{repas.description}}
        </div>

        <div>
          categorie : {{repas.categorie}}
        </div>

        <div>
          prix : {{repas.prix}} $
        </div>

        <div>
          repas vege : {{repas.vege}}
        </div>

        <div id="image">
          <img :src="'./public/images/'+repas.name+'Petite.jpg'">
        </div>
      </a>
      </div>
      </div>`
  })


  var app = new Vue({
    el: '#app',

    data: {
      menu: JSON.parse('<%-menu%>'),
      fontSize: '30px',
      entrerChk: false,
      platChk: false,
      dessertChk: false,
      vegeChk: false,
    },

    computed: {
      menuFiltredVege: function () {
        return this.menu.filter(plat => plat.vege == true)
      }
    },

    methods:{
      menuFiltred: function (entrerChk,platChk,dessertChk,vege) {
        menuFiltred = []
        if(vege){
          if(entrerChk){menuFiltred = menuFiltred.concat(this.menuFiltredVege.filter(plat => plat.categorie == "entrer"))}
          if(platChk){menuFiltred = menuFiltred.concat(this.menuFiltredVege.filter(plat => plat.categorie == "plat"))}
          if(dessertChk){menuFiltred = menuFiltred.concat(this.menuFiltredVege.filter(plat => plat.categorie == "dessert"))}
        }
        if(!vege){
          if(entrerChk){menuFiltred = menuFiltred.concat(this.menu.filter(plat => plat.categorie == "entrer"))}
          if(platChk){menuFiltred = menuFiltred.concat(this.menu.filter(plat => plat.categorie == "plat"))}
          if(dessertChk){menuFiltred = menuFiltred.concat(this.menu.filter(plat => plat.categorie == "dessert"))}
        }
        if(!vege && !entrerChk && !platChk && !dessertChk){menuFiltred = this.menu}
        if(vege && !entrerChk && !platChk && !dessertChk){menuFiltred = this.menuFiltredVege}

        return menuFiltred
        // filtre par rapport aux chk
      },
    }, 

  })
</script>

</html>